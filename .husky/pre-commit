#!/bin/sh

echo "ğŸ” Running pre-commit checks..."

# 1. KjÃ¸r alle backend tester
echo "ğŸ“ Running backend tests..."
cd backend && npm test -- --passWithNoTests
if [ $? -ne 0 ]; then
  echo "âŒ Backend tests failed!"
  exit 1
fi
cd ..

# 2. KjÃ¸r frontend build (sjekker kompilering)
echo "ğŸ—ï¸  Building frontend..."
cd frontend && npm run build > /dev/null 2>&1
if [ $? -ne 0 ]; then
  echo "âŒ Frontend build failed!"
  exit 1
fi
cd ..

# 3. Sjekk at dokumentasjon er oppdatert (kun notis, blokkerer ikke)
echo "ğŸ“š Checking documentation..."
if git diff --cached --name-only | grep -E "(backend/modules|backend/shared|backend/migrations)" > /dev/null; then
  if ! git diff --cached --name-only | grep -E "(ARCHITECTURE.md|DATABASE.md|MIGRATION_NOTES.md)" > /dev/null; then
    echo ""
    echo "ğŸ“ NOTIS: Kode-endringer detektert uten dokumentasjons-oppdateringer"
    echo "   Vurder Ã¥ oppdatere:"
    echo "   - ARCHITECTURE.md (ved nye moduler/endpoints)"
    echo "   - DATABASE.md (ved schema endringer)"
    echo "   - MIGRATION_NOTES.md (ved breaking changes)"
    echo ""
    echo "   ğŸ’¡ TIP: Be AI om Ã¥ oppdatere dokumentasjon automatisk!"
    echo ""
  fi
fi

echo "âœ… All pre-commit checks passed!"
exit 0

